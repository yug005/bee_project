datasource db {
provider = "postgresql"
url      = env("DATABASE_URL")
}

generator client {
provider = "prisma-client-js"
}

model User {
id       Int       @id @default(autoincrement())
username String?
email    String    @unique
password String
role     String    @default("user")
bookings Booking[]
}

model State {
id      Int      @id @default(autoincrement())
name    String   @unique
code    String   @unique
cities  City[]
}

model City {
id       Int       @id @default(autoincrement())
name     String
stateId  Int
state    State     @relation(fields: [stateId], references: [id])
stations Station[]
}

model Station {
id           Int     @id @default(autoincrement())
name         String
code         String  @unique
cityId       Int
city         City    @relation(fields: [cityId], references: [id])
trainsFrom   Train[] @relation("FromStation")
trainsTo     Train[] @relation("ToStation")
}

model Train {
id                Int       @id @default(autoincrement())
name              String
trainNumber       String    @unique
fromStationId     Int
toStationId       Int
fromStation       Station   @relation("FromStation", fields: [fromStationId], references: [id])
toStation         Station   @relation("ToStation", fields: [toStationId], references: [id])
totalSeats        Int
availableSeats    Int
departureTime     String
arrivalTime       String    @default("")
duration          String    @default("")
price             Float     @default(50.0)
class             String    @default("Economy")
trainType         String    @default("Express")
runsOn            String    @default("Daily")
bookings          Booking[]
seatConfiguration String    @default("3AC")
}

model Booking {
id              Int      @id @default(autoincrement())
createdAt       DateTime @default(now())
journeyDate     DateTime
userId          Int
user            User     @relation(fields: [userId], references: [id])
trainId         Int
train           Train    @relation(fields: [trainId], references: [id])
seatNumber      String   @default("")
coachNumber     String   @default("")
pnrNumber       String   @unique @default(cuid())
qrCode          String   @default("")
status          String   @default("Waiting") // Waiting, RAC, Confirmed, Cancelled
passengerName   String   @default("")
passengerAge    Int      @default(0)
waitingPosition Int?     // Position in waiting list
confirmedAt     DateTime? // When ticket was confirmed
}
